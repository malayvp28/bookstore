<html>
<head>
 
   <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="css\admin_style.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js"></script>

<style>
.noti
{

color:black;
height:11px;
width:11px;
float:right;
background-color:rgb(10,10, 150);
border-radius:50% 50%;
margin-top:8px;
margin-left:5px;
animation: spin 2s linear infinite;
animation-name: example;
animation-duration: 1s;
}

@keyframes example {
  from {background-color: rgb(0,0,150);}
  to {background-color: rgb(150,150,200);}
}
</style>
  </head>
 
<body>
<ul>
  <li><a href="#home"><span class="logo">
<span style="font-size:50px;">B</span>ookStore
</span></a></li>


 <li style="float:right;height:40px;background-color:rgb(150,0,0);padding-left:10px;padding-right:10px;font-size:15px;text-align:center;color:white" ><button class="btn notification" style="color:white;font-family:sans" onclick="logout()"> Logout</button></li>
  <li style="float:right;height:40px;background-color:rgb(100,100,0);padding-left:10px;padding-right:10px;font-size:15px;text-align:center;color:white" ><button class="btn" id="cart-button" style="color:white;font-family:sans" data-toggle="modal" data-target="#myModal"  ><span>cart</span ><div class="noti" style="display:none" id="cart-noti"></div></button></li>
  <li style="float:right;height:40px;background-color:rgb(0,170,0);padding-left:10px;padding-top:10px;padding-right:10px;font-size:15px;text-align:center" ><i class="far fa-user" style="font-size:15px;margin-right:5px;"></i><span id="lblData" style="font-family:sans"></span></li>
  
</ul>
<div class="modal fade" id="myModal" style="color:black">
    <div class="modal-dialog modal-xl modal-dialog-scrollable ">
      <div class="modal-content">
      
        <!-- Modal Header -->
        <div class="modal-header">
          <h4 class="modal-title">My Cart</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        
        <!-- Modal body -->
        <div class="modal-body">
         
		<table class="table table-striped" id="" style="background-color:white;margin-top:2%;">
  <thead>
      <tr class="">
        <th class="">ID</th>
        <th class="">Name</th>
        <th class="">Author</th>
		<th class="">Price</th>
		<th class="">Quantity</th>
		<th class="">Remove</th>
      </tr>
    </thead>

    <tbody id="cart-data">
      
    </tbody>

  </table>
		
		</div>
        
        <!-- Modal footer -->
        <div class="modal-footer">
		    <button type="button" class="btn " style="background-color:rgb(0,150,0);" onclick="billGenrate()">Buy</button>
          <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
        </div>
        
      </div>
    </div>
</div>
  

  
  
 
   
 <input type="text" id="myInput" onkeyup="search()" placeholder="Search for names.." title="Type in a name" style="float:left;margin-top:2%:">
   <div style="padding-left:0%;background-color:black;height:12%;">

   <button class="btn"  id="search-button" style="float:left;margin-top:0px;margin-left:0%;background-color:white;height:45px;width:80px;border-radius:0px 20px 20px 0px;border:0px ;margin-top:20px;">Search</button>

</div>
    </div>
  
<div class="container justify-content-center" style="margin-top:20px;margin-bottom:50px;">

  
  


<div style="color:white">  <span style="margin-left:38%;font-size:30px;margin-bottom:10px;">-Available Books-</span><hr style="background-color:white"></div>
<div style="margin-top:50px;padding-left:40px;margin-left:40%;">
					<p id="success" style="color:rgb(0,220,0);font-size:15px;"></p>
					<p id="error" style="color:red;font-size:15px;"></p>
</div>
  <table class="table table-striped" id="" style="background-color:white;margin-top:2%;">
  <thead>
      <tr class="">
        <th class="">ID</th>
        <th class="">Name</th>
        <th class="">Author</th>
		<th class="">Price</th>
		
		<th class="">Cart</th>
      </tr>
    </thead>

    <tbody id="table-data">
      
    </tbody>

	<tbody id="search-data">
      
    </tbody>
  </table>


</div>
<footer class="footer font-small   " style="background-color:rgb(10,10,10);">

  <!-- Footer Text -->
 
  <!-- Footer Text -->

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">Â© 2020 Copyright:
    <a href="https://demo.com/"> Demo.com</a>
  </div>
  <!-- Copyright -->

</footer>

<script type="text/javascript">
console.log("tes");
function message(message , status)
{
   if(status == true)
   {
   $("#success").html(message).slideDown();
   $("#error").slideUp();
   setTimeout(function(){
   $("#success").slideUp();
   },4000);
   }
   else
   {
	  $("#success").slideUp();
      $("#error").html(message).slideDown();
	  setTimeout(function(){
      $("#error").slideUp();
      },4000);
   }
}
var username;
    var queryString = new Array();
    window.onload = function () {
	 console.log("tes");
        if (queryString.length == 0) {
            if (window.location.search.split('?').length > 1) {
                var params = window.location.search.split('?')[1].split('&');
                for (var i = 0; i < params.length; i++) {
                    var key = params[i].split('=')[0];
                    var value = decodeURIComponent(params[i].split('=')[1]);
                    queryString[key] = value;
                }
            }
        }
        if (queryString["name"] != null) {
          
            data =  queryString["name"] ;
            document.getElementById("lblData").innerHTML = data;
			username=data;
        }
		
		
		
    };
	
	function LoadData(){
	console.log("LoadData");
	$.ajax({
	  url :"http://localhost:8080/getbook",
	  type : "GET",
	  success : function(data)
	  {
	  var s="<tr>";
	  
	  for(var i=0;i<data.length;i++)
	  {
	 // console.log(data.length,s,data);
	  s+= "<tr><td>"+data[i].id+"</td><td>"+data[i].name+"</td><td>"+data[i].author+"</td><td>"+data[i].price+"Rs.</td><<td><button class='btn cart-btn' style='background-color:rgb(0,150,0);color:white'  data-id='"+data[i].id+"' data-name='"+data[i].name+"' data-price='"+data[i].price+"' data-author='"+data[i].author+"' >Add to Cart</button></td>/tr>"
	 }
	  $("#table-data").html(s);
	  }
	  
	});
	
	}
	function logout()
	{
	 if(confirm("Are You Sure !!!"))
	 {
	 window.location.replace("file:///C:/Users/Pruthvi/Desktop/MAP%20INOVATIVE/map/login.html");
	 }
	}
	$(document).ready(function(){
	$("#table-data").slideDown();
	$("Insert").slideUp();
	LoadData();
	});
	
	
//save data	//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
$("#save-button").on("click",function(e){
  console.log("test");
  e.preventDefault();
  
  var arr =$("#insert").serializeArray();
  console.log(arr);
  var obj={};
  var st=true;
  for(var a=0;a < arr.length;a++)
  {
   obj[arr[a].name]=arr[a].value;
   if(arr[a].value == "")
   { 
   st=false;
   }
  }
  if(st == true){
  var json=JSON.stringify(obj);
  json = encodeURIComponent(json);
  console.log(json);
  console.log(obj);
  var fdata={
        "id": $("#sid").val(),
        "name": $('#sname').val(),
        "price": $("#sprice").val(),
        "url": "demo.jpg",
        "author": $("#sauthor").val()
    };
  console.log(fdata);
  $.ajax({
  type : "POST",
  contentType : "application/json", 
  url : 'http://localhost:8080/addbook',
  data : JSON.stringify(fdata),
  dataType :"json",
  success :  function(data)
  {
  console.log("success");
  
  if(data.status == true)
  {
  
   $("#insert").trigger("reset");
   LoadData();
  }
  }
  });
  }
  else
   console.log("not add"); 
  LoadData();
  

  });
  
  
  
  
  
  //update///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
function search(){

  $("#table-data").hide();
 var input = $("#myInput").val();
  $.ajax({
	  url :"http://localhost:8080/getbook/"+input,
	  type : "GET",
	  success : function(data)
	  {
	  var s="<tr>";
	  
	  for(var i=0;i<data.length;i++)
	  {
	 // console.log(data.length,s,data);
	  s+= "<tr><td>"+data[i].id+"</td><td>"+data[i].name+"</td><td>"+data[i].author+"</td><td>"+data[i].price+"Rs.</td><<td><button class='btn cart-btn' style='background-color:rgb(0,150,0);color:white'  data-id='"+data[i].id+"' data-name='"+data[i].name+"' data-price='"+data[i].price+"' data-author='"+data[i].author+"' >Add to Cart</button></td>/tr>"
	 }
	  $("#search-data").html(s);
	  console.log(s);
	  }
	  
	});
  

  }
  
	
	//cart/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
function cartload()
{
 $.ajax({
	  url :"http://127.0.0.1:5000/gets/"+username,
	  type : "GET",
	  success : function(data)
	  {
	  var s="<tr>";
	  
	  for(var i=0;i<data.length;i++)
	  {
	 // console.log(data.length,s,data);
	  s+= "<tr><td>"+data[i][0]+"</td><td>"+data[i][4]+"</td><td>"+data[i][5]+"</td><td>"+data[i][6]+"Rs.</td><td>"+data[i][3]+"</td><td><button class='btn remove-btn' style='background-color:rgb(150,0,0);color:white'  data-id='"+data[i][1]+"' >Remove</button></td>/tr>"
	 }
	  $("#cart-data").html(s);
	  $("#cart-noti").slideUp();
	  }
	  
	});
}
$("#cart-button").on("click",function(){

cartload();
  
});

//add cart//////////////////////////////////////////////////////////////////////////////////////////////////////////

$(document).on("click",".cart-btn",function(){
    var a =  $(this).data("id");
	console.log(a);
	console.log("cart test");
		
		  var fdata={
        "bid": a,
        "cuser": username,
         "qnty": 1
        
    };
  console.log(fdata);
  $.ajax({
  type : "POST",
  contentType : "application/json", 
  url : 'http://127.0.0.1:5000/',
  data : JSON.stringify(fdata),
  dataType :"json",
  success :  function(data)
  {
  console.log("success");

  if(data.status == true)
  {
  
   console.log(data);
   message(data.message , data.status);
   $("#cart-noti").slideDown();
   $("#insert").trigger("reset");
   LoadData();
  }
  }
  });
 });
 
 
 //delete////////////////////////////////////////////////////////////////////////////////////////////////////////////////
 
 $(document).on("click",".remove-btn",function(){
    var a =  $(this).data("id");
	console.log(a);
	

  $.ajax({
  type : "DELETE",
  url : 'http://localhost:8080/deletecart/'+a,
  success :  function(data)
  {
  
  console.log("success");
  cartload();
  }
  });

 cartload();
 });
 
 
 
 //bill Genrate ////////////////////////////////////////////////////////////////////////////////////////////////////////////
 

function billGenrate(){
console.log("test");
window.location.href = "file:///C:/Users/Pruthvi/Desktop/MAP%20INOVATIVE/map/bill.html?name="+username;

} 
	
	
</script>
</body>
</html>